!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MonacoBlock=t():e.MonacoBlock=t()}(window,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t,n){return o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&i(r,n.prototype),r},o.apply(null,arguments)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,s(o.key),o)}}function a(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=function(e,t){if("object"!==n(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,"string");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===n(t)?t:String(t)}e.r(t),e.d(t,{default:()=>c});var c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"decorationsCollection",null),a(this,"firstSelection",null),a(this,"isMac",/macintosh|mac os x/i.test(navigator.userAgent)),this.editor=t,this.selectionBlock=null,this.options=Object.assign({},{cancelJsDiagnostics:!0,cancelJsCompletionItems:!0},n),this.init()}var t,n;return t=e,n=[{key:"_setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,n=t.cancelJsDiagnostics,o=t.cancelJsCompletionItems;n&&window.window.monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!e,noSyntaxValidation:!e}),o&&window.monaco.languages.typescript.javascriptDefaults.setModeConfiguration({completionItems:e})}},{key:"init",value:function(){var e=this;this._setOptions();var t=this;this.editor.onDidChangeModelContent(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=null;return function(){n&&clearTimeout(n),n=setTimeout((function(){t.selectionBlock&&(t.handleParseZero2decoration(),t.selectionBlock={}),n=null}),e)}}()),this.editor.onDidChangeCursorSelection(this.handleChangeCursorSelection.bind(this)),this.editor.onMouseDown((function(){setTimeout((function(){e.firstSelection=e.editor.getPosition()}),50)})),this.editor.onMouseUp((function(){setTimeout((function(){e.firstSelection=null;var t=e.editor.getSelection();e.selectionBlock=e.handleIsIndecorationRange(t,!0,!0,!0)}),50)})),this.editor.onKeyDown((function(t){!(e.isMac?t.metaKey:t.ctrlKey)||56!==t.keyCode&&52!==t.keyCode&&55!==t.keyCode?1!==t.keyCode&&20!==t.keyCode||e.editor.hasTextFocus()&&(t.preventDefault(),t.stopPropagation(),e.handleResetBackspace(20===t.keyCode)):setTimeout((function(){e.handleParseZero2decoration()}),50)})),this.handleParseZero2decoration()}},{key:"handleResetBackspace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.editor.hasTextFocus()){var t=this.editor.getPosition(),n=t.lineNumber,o=t.column,i=this.editor.getSelection(),r=i.endColumn,l=i.endLineNumber,a=i.startColumn,s=i.startLineNumber,c={},u=!1;if(c=s===l&&a===r?this.handleIsIndecorationRange(i,e,!0):this.handleIsIndecorationRange(i,!1,!0,!0)){if(this.options.deleteBlockCode){for(var d,h,f=0,m=[];f<c.ranges.length;){var g=c.ranges[f];m.push({code:this._utilGetDecorationInRangeData(g),range:g}),f++}null===(d=this.options)||void 0===d||null===(h=d.deleteBlockCode)||void 0===h||h.call(d,m)}u=!0}else c=e?{lineNumbers:[s,l],columns:[a,r===a?r+1:r]}:{lineNumbers:[s,l],columns:[a===r?a-1:a,r]};if(this.editor.executeEdits("",[{range:new window.monaco.Range(c.lineNumbers[0],c.columns[0],c.lineNumbers[1],c.columns[1]),text:"",forceMoveMarkers:!0}]),u&&this.handleParseZero2decoration(),1===o&&1!==n){var p=this.editor.getModel().getLineMaxColumn(n)-1;this.editor.executeEdits("",[{range:new window.monaco.Range(n-1,this.editor.getModel().getLineMaxColumn(n-1),n,0),text:"",forceMoveMarkers:!0}]),this.editor.setPosition({lineNumber:n-1,column:this.editor.getModel().getLineMaxColumn(n-1)-p})}}}},{key:"handleChangeCursorSelection",value:function(e){var t,n,o=e.selection,i=e.source,l=e.oldSelections;if(this.decorationsCollection&&["mouse","keyboard"].includes(i)){var a=!this.firstSelection,s=null;if(s=this.handleIsIndecorationRange(o),a){if(!s)return;var c=(t=s.columns,n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r,l,a=[],s=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(a.push(o.value),a.length!==t);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(c)throw i}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],d=c[1],h=o.startColumn,f=o.startLineNumber,m=l[0],g=m.startLineNumber,p=m.startColumn;if("mouse"===i){var v={lineNumber:f,column:(u+d)/2>h?u:d};this.editor.setPosition(v)}else if(g===f){var y={lineNumber:f,column:h>p?d:u};this.editor.setPosition(y)}else{var b={lineNumber:f,column:(u+d-1)/2>h?u:d};this.editor.setPosition(b)}}else{var C=o.positionLineNumber,k=o.positionColumn,w=this.firstSelection,S=w.lineNumber,N=w.column,x=C>S||C===S&&k>N;s||(s={columns:[o.positionColumn,o.positionColumn]}),x?this.editor.setSelection({endColumn:s.columns[1],endLineNumber:C,startColumn:N,startLineNumber:S}):this.editor.setSelection({endColumn:N,endLineNumber:S,startColumn:s.columns[0],startLineNumber:C})}}}},{key:"handleIsIndecorationRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.decorationsCollection){for(var i=this.decorationsCollection.getRanges(),r=0,l=null;r<i.length;){var a=i[r],s=a.startLineNumber,c=a.startColumn+ +!t,u=a.endColumn+ +n;if(o){var d=e.endColumn,h=e.endLineNumber,f=e.startColumn,m=e.startLineNumber;e.containsRange(a)&&(l?(l.index.push(r),l.ranges.push(a)):l={lineNumbers:[m,h],columns:[f,d],index:[r],ranges:[a]}),r++}else{if(s===e.positionLineNumber&&e.positionColumn>=c&&e.positionColumn<u)return{lineNumbers:[s,s],columns:[a.startColumn,a.endColumn],index:[r],ranges:[a]};r++}}return l}return null}},{key:"_utilGetDecorationInRangeData",value:function(e){return this.editor.getModel().getValueInRange(e).replace(/\u200b/g,"")}},{key:"handleParseZero2decoration",value:function(){var e=this.editor.getModel().findMatches(/\u200b[\s\S]+?\u200b/,!1,!0);if(e.length){for(var t=[],n=0;n<e.length;n++){var o=e[n].range,i=this._utilGetDecorationInRangeData(o);t.push({range:o,options:this.handleDecorationOption(i)})}this.decorationsCollection?this.decorationsCollection.set(t):this.decorationsCollection=this.editor.createDecorationsCollection(t)}}},{key:"handleDecorationOption",value:function(e){var t=this.options,n=t.blockClassName,o=t.customBlockStyle,i={};return o?(i=o(e)).description=e:i={inlineClassName:n||"editor-custom-block",stickiness:window.monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,description:e},i}},{key:"handleFixBlockEdge",value:function(e){var t=this.editor.getDecorationsInRange(e).length;return t&&this.handleParseZero2decoration(),t}},{key:"getAllBlockMessage",value:function(){return this.handleParseZero2decoration(),this.decorationsCollection.getRanges()}},{key:"addCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"focus",n=(null==e?void 0:e.code)||e;if(n&&this.editor){var i=null;if("focus"===t){var r=this.editor.getSelection();i=new window.monaco.Range(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn)}else{var l=this.editor.getModel().getLineCount();i=new window.monaco.Range(l+1,1,l+1,1)}var a={range:i,text:n,forceMoveMarkers:!0};if(null!=e&&e.isNormal){if(!this.selectionBlock){var s=(n.match(/{@[\s\S]+?@}/)||[]).length;s&&(a.text=n.replace(/{@([\s\S]+?)@}/g,"​$1​")),this.editor.executeEdits("",[a]),s?this.handleParseZero2decoration():this.handleFixBlockEdge(i)}}else{a.text="​".concat(a.text,"​");var c=[i.startLineNumber,i.startColumn,i.startLineNumber,i.startColumn+a.text.length];this.editor.executeEdits("",[a]),this.decorationsCollection?this.selectionBlock||this.handleFixBlockEdge(i)||this.decorationsCollection.append([{range:o(window.monaco.Range,c),options:this.handleDecorationOption(e)}]):this.decorationsCollection=this.editor.createDecorationsCollection([{range:o(window.monaco.Range,c),options:this.handleDecorationOption(e)}])}this.editor.focus()}}},{key:"getCode",value:function(){var e=this.editor.getValue();return{value:e.replace(/\u200b/g,""),blockValue:e}}},{key:"clear",value:function(){this.editor.setValue(""),this.decorationsCollection=null}},{key:"destroy",value:function(){var e,t;this._setOptions(!0),null===(e=this.editor)||void 0===e||null===(t=e.dispose)||void 0===t||t.call(e)}}],n&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();return t.default})()));